<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MarvelReview - API</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <main class="container">
      <div id="nav-root"></div>

      <section class="page-intro">
        <div>
          <h1>API Read-Only (Films &amp; S&eacute;ries)</h1>
          <p>Documentation des routes RPC publiques pour consulter les donn&eacute;es films et s&eacute;ries.</p>
        </div>
        <p id="auth-status" class="status"></p>
      </section>

      <p id="page-message" class="message" aria-live="polite"></p>

      <section class="card home-stack-card">
        <div class="home-stack-chunk">
          <h2>Principe</h2>
          <p>Cette API est en lecture seule. Aucune route d'&eacute;criture n'est expos&eacute;e ici.</p>
          <p>
            Les routes ci-dessous correspondent &agrave; des fonctions RPC Supabase et se consomment en HTTP:
            <code>POST /rest/v1/rpc/&lt;function_name&gt;</code>.
          </p>
        </div>

        <div class="home-stack-chunk">
          <h2>Base URL et headers</h2>
          <p>Base URL:</p>
          <pre><code>https://YOUR_PROJECT_ID.supabase.co/rest/v1/rpc</code></pre>
          <p>Headers minimum:</p>
          <pre><code>apikey: YOUR_SUPABASE_ANON_KEY
Authorization: Bearer YOUR_SUPABASE_ANON_KEY
Content-Type: application/json</code></pre>
        </div>

        <div class="home-stack-chunk">
          <h2>Endpoints Films</h2>
          <div class="table-wrapper">
            <table class="ranking-table compact">
              <thead>
                <tr>
                  <th>Route</th>
                  <th>Param&egrave;tres</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>POST /rest/v1/rpc/api_film_score</code></td>
                  <td>
                    <code>p_film_ref</code>, <code>p_scope</code> (<code>global</code>/<code>media</code>/<code>user</code>),
                    <code>p_scope_value</code>
                  </td>
                </tr>
                <tr>
                  <td><code>POST /rest/v1/rpc/api_film_reviews</code></td>
                  <td>
                    <code>p_film_ref</code>, <code>p_scope</code>, <code>p_scope_value</code>,
                    <code>p_limit</code>, <code>p_offset</code>
                  </td>
                </tr>
                <tr>
                  <td><code>POST /rest/v1/rpc/api_film_rank_in_franchise</code></td>
                  <td><code>p_film_ref</code>, <code>p_mode</code> (<code>all</code>/<code>films_only</code>)</td>
                </tr>
                <tr>
                  <td><code>POST /rest/v1/rpc/api_film_rank_in_franchise_all_content</code></td>
                  <td><code>p_film_ref</code></td>
                </tr>
                <tr>
                  <td><code>POST /rest/v1/rpc/api_media_members</code></td>
                  <td><code>p_media_ref</code> (nom media exact ou UUID)</td>
                </tr>
                <tr>
                  <td><code>POST /rest/v1/rpc/api_film_catalog</code></td>
                  <td>Aucun</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="home-stack-chunk">
          <h2>Endpoints S&eacute;ries</h2>
          <div class="table-wrapper">
            <table class="ranking-table compact">
              <thead>
                <tr>
                  <th>Route</th>
                  <th>Param&egrave;tres</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>POST /rest/v1/rpc/api_series_score</code></td>
                  <td>
                    <code>p_series_ref</code>, <code>p_scope</code> (<code>global</code>/<code>media</code>/<code>user</code>),
                    <code>p_scope_value</code>
                  </td>
                </tr>
                <tr>
                  <td><code>POST /rest/v1/rpc/api_series_reviews</code></td>
                  <td>
                    <code>p_series_ref</code>, <code>p_scope</code>, <code>p_scope_value</code>,
                    <code>p_limit</code>, <code>p_offset</code>
                  </td>
                </tr>
                <tr>
                  <td><code>POST /rest/v1/rpc/api_series_rank_in_franchise</code></td>
                  <td><code>p_series_ref</code>, <code>p_mode</code> (<code>all</code>/<code>series_only</code>)</td>
                </tr>
                <tr>
                  <td><code>POST /rest/v1/rpc/api_latest_activity</code></td>
                  <td><code>p_limit</code></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="home-stack-chunk">
          <h2>R&eacute;f&eacute;rences accept&eacute;es</h2>
          <p><code>p_film_ref</code> accepte: <code>slug</code>, titre exact (insensible &agrave; la casse), UUID.</p>
          <p><code>p_series_ref</code> accepte: <code>slug</code>, titre exact (insensible &agrave; la casse), UUID.</p>
          <p><code>p_media_ref</code> accepte: nom media exact (insensible &agrave; la casse), UUID.</p>
        </div>

        <div class="home-stack-chunk">
          <h2>Valeurs possibles</h2>
          <p><code>p_scope</code>: <code>global</code>, <code>media</code>, <code>user</code></p>
          <p><code>p_mode</code> films: <code>all</code>, <code>films_only</code></p>
          <p><code>p_mode</code> s&eacute;ries: <code>all</code>, <code>series_only</code></p>
          <p>
            Quand un scope media/user ne trouve aucun profil correspondant, la r&eacute;ponse retourne
            <code>rating_count = 0</code> (films) ou <code>contributor_count = 0</code> (s&eacute;ries), avec <code>average = null</code>.
          </p>
        </div>
      </section>
    </main>

    <script type="module" src="/app/common.js"></script>
    <script type="module" src="/app/api.js"></script>
  </body>
</html>
